name: Heroku Deploy

on:
  pull_request:
    types: [ labeled ]


jobs:
  build:
    name: Deploy New Heroku App
    runs-on: ubuntu-latest
    steps:
      - name: Check out branch
        uses: actions/checkout@v2
      - name: Identify branch name
        id: vars
        run: 'echo ::set-output name=short_ref::${GITHUB_REF#refs/*/}'
      - name: Create app
        run: heroku apps:create pvcy-challenge-runtime-run
        env:
          HEROKU_API_KEY: ${{secrets.HEROKU_API_KEY}}
      - name: Run Submitted Scoring Module
        run: "heroku run worker --app pvcy-challenge-runtime-run"
      - name: Destory Heroku App
        run: "heroku apps:destroy pvcy-challenge-runtime-run --confirm pvcy-challenge-runtime-run"